/* Blur.c generated by valac 0.48.17, the Vala compiler
 * generated from Blur.vala, do not modify */

#include <glib.h>
#include <float.h>
#include <math.h>
#include <cairo-gobject.h>

void light_pad_frontend_blurinner (guchar* pixel,
                                   gint* zR,
                                   gint* zG,
                                   gint* zB,
                                   gint* zA,
                                   gint alpha,
                                   gint aprec,
                                   gint zprec);
void light_pad_frontend_blurrow (guchar* pixels,
                                 gint width,
                                 gint height,
                                 gint rowstride,
                                 gint channels,
                                 gint line,
                                 gint alpha,
                                 gint aprec,
                                 gint zprec);
void light_pad_frontend_blurcol (guchar* pixels,
                                 gint width,
                                 gint height,
                                 gint rowstride,
                                 gint channels,
                                 gint x,
                                 gint alpha,
                                 gint aprec,
                                 gint zprec);
void light_pad_frontend_expblur (guchar* pixels,
                                 gint width,
                                 gint height,
                                 gint rowstride,
                                 gint channels,
                                 gdouble radius,
                                 gint aprec,
                                 gint zprec);
void light_pad_frontend_gtk_cairo_blur_surface (cairo_surface_t* surface,
                                                gdouble radius);
gint light_pad_frontend_gtk_cairo_blur_compute_pixels (gdouble radius);

void
light_pad_frontend_blurinner (guchar* pixel,
                              gint* zR,
                              gint* zG,
                              gint* zB,
                              gint* zA,
                              gint alpha,
                              gint aprec,
                              gint zprec)
{
	gint R = 0;
	gint G = 0;
	gint B = 0;
	guchar A = '\0';
#line 12 "../docklets/Lightpad/Blur.vala"
	R = (gint) (*pixel);
#line 13 "../docklets/Lightpad/Blur.vala"
	G = (gint) (*(pixel + 1));
#line 14 "../docklets/Lightpad/Blur.vala"
	B = (gint) (*(pixel + 2));
#line 15 "../docklets/Lightpad/Blur.vala"
	A = *(pixel + 3);
#line 17 "../docklets/Lightpad/Blur.vala"
	*zR += (alpha * ((R << zprec) - (*zR))) >> aprec;
#line 18 "../docklets/Lightpad/Blur.vala"
	*zG += (alpha * ((G << zprec) - (*zG))) >> aprec;
#line 19 "../docklets/Lightpad/Blur.vala"
	*zB += (alpha * ((B << zprec) - (*zB))) >> aprec;
#line 20 "../docklets/Lightpad/Blur.vala"
	*zA += (alpha * ((A << zprec) - (*zA))) >> aprec;
#line 22 "../docklets/Lightpad/Blur.vala"
	*pixel = (guchar) ((*zR) >> zprec);
#line 23 "../docklets/Lightpad/Blur.vala"
	*(pixel + 1) = (guchar) ((*zG) >> zprec);
#line 24 "../docklets/Lightpad/Blur.vala"
	*(pixel + 2) = (guchar) ((*zB) >> zprec);
#line 25 "../docklets/Lightpad/Blur.vala"
	*(pixel + 3) = (guchar) ((*zA) >> zprec);
#line 86 "Blur.c"
}

void
light_pad_frontend_blurrow (guchar* pixels,
                            gint width,
                            gint height,
                            gint rowstride,
                            gint channels,
                            gint line,
                            gint alpha,
                            gint aprec,
                            gint zprec)
{
	gint zR = 0;
	gint zG = 0;
	gint zB = 0;
	gint zA = 0;
	gint index = 0;
	guchar* scanline = NULL;
	guchar* _tmp0_;
	guchar* _tmp1_;
	guchar* _tmp2_;
	guchar* _tmp3_;
#line 36 "../docklets/Lightpad/Blur.vala"
	scanline = &pixels[line * rowstride];
#line 38 "../docklets/Lightpad/Blur.vala"
	_tmp0_ = scanline;
#line 38 "../docklets/Lightpad/Blur.vala"
	zR = (*_tmp0_) << zprec;
#line 39 "../docklets/Lightpad/Blur.vala"
	_tmp1_ = scanline;
#line 39 "../docklets/Lightpad/Blur.vala"
	zG = (*(_tmp1_ + 1)) << zprec;
#line 40 "../docklets/Lightpad/Blur.vala"
	_tmp2_ = scanline;
#line 40 "../docklets/Lightpad/Blur.vala"
	zB = (*(_tmp2_ + 2)) << zprec;
#line 41 "../docklets/Lightpad/Blur.vala"
	_tmp3_ = scanline;
#line 41 "../docklets/Lightpad/Blur.vala"
	zA = (*(_tmp3_ + 3)) << zprec;
#line 128 "Blur.c"
	{
		gboolean _tmp4_ = FALSE;
#line 43 "../docklets/Lightpad/Blur.vala"
		index = 0;
#line 43 "../docklets/Lightpad/Blur.vala"
		_tmp4_ = TRUE;
#line 43 "../docklets/Lightpad/Blur.vala"
		while (TRUE) {
#line 137 "Blur.c"
			guchar* _tmp6_;
#line 43 "../docklets/Lightpad/Blur.vala"
			if (!_tmp4_) {
#line 141 "Blur.c"
				gint _tmp5_;
#line 43 "../docklets/Lightpad/Blur.vala"
				_tmp5_ = index;
#line 43 "../docklets/Lightpad/Blur.vala"
				index = _tmp5_ + 1;
#line 147 "Blur.c"
			}
#line 43 "../docklets/Lightpad/Blur.vala"
			_tmp4_ = FALSE;
#line 43 "../docklets/Lightpad/Blur.vala"
			if (!(index < width)) {
#line 43 "../docklets/Lightpad/Blur.vala"
				break;
#line 155 "Blur.c"
			}
#line 44 "../docklets/Lightpad/Blur.vala"
			_tmp6_ = scanline;
#line 44 "../docklets/Lightpad/Blur.vala"
			light_pad_frontend_blurinner (&_tmp6_[index * channels], &zR, &zG, &zB, &zA, alpha, aprec, zprec);
#line 161 "Blur.c"
		}
	}
	{
		gboolean _tmp7_ = FALSE;
#line 46 "../docklets/Lightpad/Blur.vala"
		index = width - 2;
#line 46 "../docklets/Lightpad/Blur.vala"
		_tmp7_ = TRUE;
#line 46 "../docklets/Lightpad/Blur.vala"
		while (TRUE) {
#line 172 "Blur.c"
			guchar* _tmp9_;
#line 46 "../docklets/Lightpad/Blur.vala"
			if (!_tmp7_) {
#line 176 "Blur.c"
				gint _tmp8_;
#line 46 "../docklets/Lightpad/Blur.vala"
				_tmp8_ = index;
#line 46 "../docklets/Lightpad/Blur.vala"
				index = _tmp8_ - 1;
#line 182 "Blur.c"
			}
#line 46 "../docklets/Lightpad/Blur.vala"
			_tmp7_ = FALSE;
#line 46 "../docklets/Lightpad/Blur.vala"
			if (!(index >= 0)) {
#line 46 "../docklets/Lightpad/Blur.vala"
				break;
#line 190 "Blur.c"
			}
#line 47 "../docklets/Lightpad/Blur.vala"
			_tmp9_ = scanline;
#line 47 "../docklets/Lightpad/Blur.vala"
			light_pad_frontend_blurinner (&_tmp9_[index * channels], &zR, &zG, &zB, &zA, alpha, aprec, zprec);
#line 196 "Blur.c"
		}
	}
}

void
light_pad_frontend_blurcol (guchar* pixels,
                            gint width,
                            gint height,
                            gint rowstride,
                            gint channels,
                            gint x,
                            gint alpha,
                            gint aprec,
                            gint zprec)
{
	gint zR = 0;
	gint zG = 0;
	gint zB = 0;
	gint zA = 0;
	gint index = 0;
	guchar* ptr = NULL;
	guchar* _tmp0_;
	guchar* _tmp1_;
	guchar* _tmp2_;
	guchar* _tmp3_;
	guchar* _tmp4_;
#line 58 "../docklets/Lightpad/Blur.vala"
	ptr = pixels;
#line 59 "../docklets/Lightpad/Blur.vala"
	_tmp0_ = ptr;
#line 59 "../docklets/Lightpad/Blur.vala"
	ptr = _tmp0_ + (x * channels);
#line 61 "../docklets/Lightpad/Blur.vala"
	_tmp1_ = ptr;
#line 61 "../docklets/Lightpad/Blur.vala"
	zR = (*((guchar*) _tmp1_)) << zprec;
#line 62 "../docklets/Lightpad/Blur.vala"
	_tmp2_ = ptr;
#line 62 "../docklets/Lightpad/Blur.vala"
	zG = (*(((guchar*) _tmp2_) + 1)) << zprec;
#line 63 "../docklets/Lightpad/Blur.vala"
	_tmp3_ = ptr;
#line 63 "../docklets/Lightpad/Blur.vala"
	zB = (*(((guchar*) _tmp3_) + 2)) << zprec;
#line 64 "../docklets/Lightpad/Blur.vala"
	_tmp4_ = ptr;
#line 64 "../docklets/Lightpad/Blur.vala"
	zA = (*(((guchar*) _tmp4_) + 3)) << zprec;
#line 245 "Blur.c"
	{
		gboolean _tmp5_ = FALSE;
#line 66 "../docklets/Lightpad/Blur.vala"
		index = 0;
#line 66 "../docklets/Lightpad/Blur.vala"
		_tmp5_ = TRUE;
#line 66 "../docklets/Lightpad/Blur.vala"
		while (TRUE) {
#line 254 "Blur.c"
			guchar* _tmp7_;
#line 66 "../docklets/Lightpad/Blur.vala"
			if (!_tmp5_) {
#line 258 "Blur.c"
				gint _tmp6_;
#line 66 "../docklets/Lightpad/Blur.vala"
				_tmp6_ = index;
#line 66 "../docklets/Lightpad/Blur.vala"
				index = _tmp6_ + 1;
#line 264 "Blur.c"
			}
#line 66 "../docklets/Lightpad/Blur.vala"
			_tmp5_ = FALSE;
#line 66 "../docklets/Lightpad/Blur.vala"
			if (!(index < height)) {
#line 66 "../docklets/Lightpad/Blur.vala"
				break;
#line 272 "Blur.c"
			}
#line 67 "../docklets/Lightpad/Blur.vala"
			_tmp7_ = ptr;
#line 67 "../docklets/Lightpad/Blur.vala"
			light_pad_frontend_blurinner (&_tmp7_[index * rowstride], &zR, &zG, &zB, &zA, alpha, aprec, zprec);
#line 278 "Blur.c"
		}
	}
	{
		gboolean _tmp8_ = FALSE;
#line 69 "../docklets/Lightpad/Blur.vala"
		index = height - 2;
#line 69 "../docklets/Lightpad/Blur.vala"
		_tmp8_ = TRUE;
#line 69 "../docklets/Lightpad/Blur.vala"
		while (TRUE) {
#line 289 "Blur.c"
			guchar* _tmp10_;
#line 69 "../docklets/Lightpad/Blur.vala"
			if (!_tmp8_) {
#line 293 "Blur.c"
				gint _tmp9_;
#line 69 "../docklets/Lightpad/Blur.vala"
				_tmp9_ = index;
#line 69 "../docklets/Lightpad/Blur.vala"
				index = _tmp9_ - 1;
#line 299 "Blur.c"
			}
#line 69 "../docklets/Lightpad/Blur.vala"
			_tmp8_ = FALSE;
#line 69 "../docklets/Lightpad/Blur.vala"
			if (!(index >= 0)) {
#line 69 "../docklets/Lightpad/Blur.vala"
				break;
#line 307 "Blur.c"
			}
#line 70 "../docklets/Lightpad/Blur.vala"
			_tmp10_ = ptr;
#line 70 "../docklets/Lightpad/Blur.vala"
			light_pad_frontend_blurinner (&_tmp10_[index * rowstride], &zR, &zG, &zB, &zA, alpha, aprec, zprec);
#line 313 "Blur.c"
		}
	}
}

void
light_pad_frontend_expblur (guchar* pixels,
                            gint width,
                            gint height,
                            gint rowstride,
                            gint channels,
                            gdouble radius,
                            gint aprec,
                            gint zprec)
{
	gint alpha = 0;
	gint row = 0;
	gint col = 0;
#line 97 "../docklets/Lightpad/Blur.vala"
	alpha = (gint) ((1 << aprec) * (1.0f - expf ((gfloat) ((-2.3) / (radius + 1.0)))));
#line 333 "Blur.c"
	{
		gboolean _tmp0_ = FALSE;
#line 99 "../docklets/Lightpad/Blur.vala"
		row = 0;
#line 99 "../docklets/Lightpad/Blur.vala"
		_tmp0_ = TRUE;
#line 99 "../docklets/Lightpad/Blur.vala"
		while (TRUE) {
#line 99 "../docklets/Lightpad/Blur.vala"
			if (!_tmp0_) {
#line 344 "Blur.c"
				gint _tmp1_;
#line 99 "../docklets/Lightpad/Blur.vala"
				_tmp1_ = row;
#line 99 "../docklets/Lightpad/Blur.vala"
				row = _tmp1_ + 1;
#line 350 "Blur.c"
			}
#line 99 "../docklets/Lightpad/Blur.vala"
			_tmp0_ = FALSE;
#line 99 "../docklets/Lightpad/Blur.vala"
			if (!(row < height)) {
#line 99 "../docklets/Lightpad/Blur.vala"
				break;
#line 358 "Blur.c"
			}
#line 100 "../docklets/Lightpad/Blur.vala"
			light_pad_frontend_blurrow (pixels, width, height, rowstride, channels, row, alpha, aprec, zprec);
#line 362 "Blur.c"
		}
	}
	{
		gboolean _tmp2_ = FALSE;
#line 102 "../docklets/Lightpad/Blur.vala"
		col = 0;
#line 102 "../docklets/Lightpad/Blur.vala"
		_tmp2_ = TRUE;
#line 102 "../docklets/Lightpad/Blur.vala"
		while (TRUE) {
#line 102 "../docklets/Lightpad/Blur.vala"
			if (!_tmp2_) {
#line 375 "Blur.c"
				gint _tmp3_;
#line 102 "../docklets/Lightpad/Blur.vala"
				_tmp3_ = col;
#line 102 "../docklets/Lightpad/Blur.vala"
				col = _tmp3_ + 1;
#line 381 "Blur.c"
			}
#line 102 "../docklets/Lightpad/Blur.vala"
			_tmp2_ = FALSE;
#line 102 "../docklets/Lightpad/Blur.vala"
			if (!(col < width)) {
#line 102 "../docklets/Lightpad/Blur.vala"
				break;
#line 389 "Blur.c"
			}
#line 103 "../docklets/Lightpad/Blur.vala"
			light_pad_frontend_blurcol (pixels, width, height, rowstride, channels, col, alpha, aprec, zprec);
#line 393 "Blur.c"
		}
	}
}

void
light_pad_frontend_gtk_cairo_blur_surface (cairo_surface_t* surface,
                                           gdouble radius)
{
	cairo_format_t format = 0;
	gboolean _tmp0_ = FALSE;
	cairo_format_t _tmp1_;
	guchar* _tmp3_;
#line 116 "../docklets/Lightpad/Blur.vala"
	g_return_if_fail (surface != NULL);
#line 117 "../docklets/Lightpad/Blur.vala"
	g_return_if_fail (cairo_surface_get_type ((cairo_surface_t*) surface) == CAIRO_SURFACE_TYPE_IMAGE);
#line 119 "../docklets/Lightpad/Blur.vala"
	format = cairo_image_surface_get_format ((cairo_surface_t*) surface);
#line 120 "../docklets/Lightpad/Blur.vala"
	_tmp1_ = format;
#line 120 "../docklets/Lightpad/Blur.vala"
	if (_tmp1_ == CAIRO_FORMAT_RGB24) {
#line 120 "../docklets/Lightpad/Blur.vala"
		_tmp0_ = TRUE;
#line 418 "Blur.c"
	} else {
		cairo_format_t _tmp2_;
#line 120 "../docklets/Lightpad/Blur.vala"
		_tmp2_ = format;
#line 120 "../docklets/Lightpad/Blur.vala"
		_tmp0_ = _tmp2_ == CAIRO_FORMAT_ARGB32;
#line 425 "Blur.c"
	}
#line 120 "../docklets/Lightpad/Blur.vala"
	g_return_if_fail (_tmp0_);
#line 122 "../docklets/Lightpad/Blur.vala"
	if (radius == ((gdouble) 0)) {
#line 123 "../docklets/Lightpad/Blur.vala"
		return;
#line 433 "Blur.c"
	}
#line 127 "../docklets/Lightpad/Blur.vala"
	cairo_surface_flush ((cairo_surface_t*) surface);
#line 129 "../docklets/Lightpad/Blur.vala"
	_tmp3_ = cairo_image_surface_get_data ((cairo_surface_t*) surface);
#line 129 "../docklets/Lightpad/Blur.vala"
	light_pad_frontend_expblur (_tmp3_, cairo_image_surface_get_width ((cairo_surface_t*) surface), cairo_image_surface_get_height ((cairo_surface_t*) surface), cairo_image_surface_get_stride ((cairo_surface_t*) surface), 4, radius, 16, 7);
#line 136 "../docklets/Lightpad/Blur.vala"
	cairo_surface_mark_dirty ((cairo_surface_t*) surface);
#line 443 "Blur.c"
}

/**
    * _gtk_cairo_blur_compute_pixels:
    * @radius: the radius to compute the pixels for
    *
    * Computes the number of pixels necessary to extend an image in one
    * direction to hold the image with shadow.
    *
    * This is just the number of pixels added by the blur radius, shadow
    * offset and spread are not included.
    *
    * Much of this, the 3 * sqrt(2 * pi) / 4, is the known value for
    * approximating a Gaussian using box blurs.  This yields quite a good
    * approximation for a Gaussian.  Then we multiply this by 1.5 since our
    * code wants the radius of the entire triple-box-blur kernel instead of
    * the diameter of an individual box blur.  For more details, see:
    * http://www.w3.org/TR/SVG11/filters.html#feGaussianBlurElement
    * https://bugzilla.mozilla.org/show_bug.cgi?id=590039#c19
    */
gint
light_pad_frontend_gtk_cairo_blur_compute_pixels (gdouble radius)
{
	gdouble GAUSSIAN_SCALE_FACTOR = 0.0;
	gint result = 0;
#line 158 "../docklets/Lightpad/Blur.vala"
	GAUSSIAN_SCALE_FACTOR = ((3.0 * sqrt (2 * G_PI)) / 4) * 1.5;
#line 159 "../docklets/Lightpad/Blur.vala"
	result = (gint) floor ((radius * GAUSSIAN_SCALE_FACTOR) + 0.5);
#line 159 "../docklets/Lightpad/Blur.vala"
	return result;
#line 475 "Blur.c"
}

